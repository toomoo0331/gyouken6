<html lang="ja">
<div class="a">
  <header class="header">
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="css/tmp.css">
    <link rel="stylesheet" type="text/css" href="css/select.css">
  <link rel="stylesheet" href="css/button.css">
  </header>
  <div class="top">
    <main class="main">
      <div id="map_base" >
        <img id = "map_img" alt ="" cman0Mat="movearea"></img>
      </div>
    </main>
    <aside id = "side_1" class="side">
      <div class="button03">
      <a href="javascript:OnButtonClick();">annotation</a>
      </div>
    </aside>
    <div class="sub">
      MAPの選択
      <form name="ad" class="cp_ipselect cp_sl01">
        <select name="myselect" required id="change_js">
          <option value="" hidden>選ぶ</option>
          <option value="1">コンコース日本橋口</option>
          <option value="2">選択肢2</option>
          <option value="3">選択肢3</option>
          <option value="4">選択肢4</option>
        </select>
      </form>
      <div class="button03">
      <a href="add_map.html">add_map</a>
      </div>
      <br>
      <div class="button03">
      <a href="add_img.html">add_img</a>
      </div>
    </div>
  </div>
  <div class="footer">
   <iframe id="exampleIframe" allowfullscreen="yes" frameborder="0" scrolling="no" allowvr="yes" src=""></iframe>
 </div>
</div>



<script language="javascript" type="text/javascript">
        function OnButtonClick() {
          var tmp_src=document.getElementById('exampleIframe').src;
          console.log(tmp_src);
          console.log(tmp_src.split("&")[0]);
          if(tmp_src.split("&")[1]=="ann=0"){
          document.getElementById('exampleIframe').src=tmp_src.split("&")[0]+"&ann=1";
          }
          else if(tmp_src.split("&")[1]=="ann=1"){
          document.getElementById('exampleIframe').src=tmp_src.split("&")[0]+"&ann=0";
          }
        }
    </script>



<!--　
　　　画面ロード時の処理
　　　map変更時に常にmap_baseの子要素を削除するため，
　　　初期値としてmap1を読み込み子要素を用意しておく 
-->
<script type="text/javascript" >
  window.onload = function(){
    set_map("1");
    set_selectbox();
  }
</script>

<script>
  function set_selectbox(){
    var script = document.createElement('script');
    script.src = "json/select_box.json";
    document.getElementsByTagName('head')[0].appendChild(script);
    console.log(document.getElementsByTagName('head')[0]);
  }

window.feed_select = function(results) {
  console.log("adf2");
  document["ad"]["myselect"].length = results.features.length+1;
  document["ad"]["myselect"].options[0].text = "選ぶ";
  document["ad"]["myselect"].options[0].value ="";
  for (var i = 1; i < results.features.length+1; i++) {
    var coords = results.features[i-1];
    document["ad"]["myselect"].options[i].text = coords.map;
    document["ad"]["myselect"].options[i].value = coords.num;
  }
}
</script>


<!--　
　　　map更新時の処理
　　　map_baseの子要素を削除したうえで
　　　set_map()で新たに子要素を追加する．
-->
<script>
  function set_map(value) {
    document.getElementById('map_img').src="map/map"+value+".jpg";
    var script = document.createElement('script');
    script.src = "json/map"+value+".json";
    document.getElementsByTagName('head')[0].appendChild(script);
  };

  const selected = document.getElementById("change_js");
  selected.onchange = function() {
    let tmp_i=document.getElementById('map_base').children.length;
    for(let i = 1; i < tmp_i; i++){
      document.getElementById('map_base').removeChild(document.getElementById('map_base').children[1]);
    }
    set_map(selected.value)
  };
</script>


<!--　
　　　map_baseに子要素を追加する処理
　　　jsonファイルを読み込んで追加する．
-->
<script>
 window.feed_callback = function(results) {
  for (var i = 0; i < results.features.length; i++) {
    var coords = results.features[i];
    addNote(coords.x,coords.y,coords.img);
  }
}
function addNote(x,y,name) {
  let elm = document.createElement('div');
  elm.className = 'note';
  elm.style.top = y+'%';
  elm.style.left = x+'%';
  let elm_mark = document.createElement('span');
  elm_mark.className = 'mark';
  elm_mark.img_name = name.split(".")[0];
  let elm_name = document.createElement('span');
  elm_name.className = 'camera_name';
  elm_name.textContent = "camera"+name.split(".")[0];

  elm_mark.onclick = function () {
    document.getElementById('exampleIframe').src="tmp_img.html?num="+elm_mark.img_name+"&ann=0";
  }
  elm.appendChild(elm_mark);
  elm.appendChild(elm_name);
  document.getElementById('map_base').appendChild(elm);
}

</script>

